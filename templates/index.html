<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Soroban Cinem√°tico - Robles y Robles</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body {
            margin: 0; padding: 0; background-color: #121212;
            color: #E0E0E0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex; flex-direction: column; align-items: center; overflow: hidden;
        }
        h1 { margin-top: 20px; font-weight: 300; letter-spacing: 2px; color: #00E676; }
        #canvas-container {
            width: 800px; height: 600px; border: 1px solid #333;
            box-shadow: 0 0 20px rgba(0, 230, 118, 0.1); border-radius: 10px; margin-top: 20px;
        }
        .controls { margin-top: 20px; }
        button {
            background-color: #1E1E1E; color: #00E676; border: 1px solid #00E676;
            padding: 10px 20px; border-radius: 5px; cursor: pointer; transition: all 0.3s ease;
        }
        button:hover { background-color: #00E676; color: #121212; }
    </style>
</head>
<body>
    <h1>SOROBAN CINEM√ÅTICO</h1>
    <div class="controls">
        <button onclick="agregarCanica(1)">+1 Unidad (Canica)</button>
        <button onclick="agregarCanica(5)">+5 Unidades (Tombolocha)</button>
    </div>
    <div id="canvas-container"></div>
    <<script>
        // Inicializaci√≥n ampliada por Elena üèÉ‚Äç‚ôÄÔ∏èüí® (Agregamos Body y Constraint)
        const Engine = Matter.Engine, 
              Render = Matter.Render, 
              Runner = Matter.Runner, 
              Bodies = Matter.Bodies, 
              Body = Matter.Body, 
              Constraint = Matter.Constraint, 
              Composite = Matter.Composite;

        const engine = Engine.create();
        const render = Render.create({
            element: document.getElementById('canvas-container'),
            engine: engine,
            options: { width: 800, height: 600, wireframes: false, background: 'transparent' }
        });

        // üèóÔ∏è 1. Construir las piezas del contenedor
        const opcionesPared = { render: { fillStyle: '#333' } };
        const base = Bodies.rectangle(400, 350, 160, 20, opcionesPared);
        const izq = Bodies.rectangle(330, 260, 20, 200, opcionesPared);
        const der = Bodies.rectangle(470, 260, 20, 200, opcionesPared);

        // Agrupamos las piezas en un solo "Cuerpo Din√°mico"
        const contenedor = Body.create({
            parts: [base, izq, der],
            friction: 0.5,
            mass: 10,
            inertia: Infinity  // <-- ¬°MAGIA! Esto bloquea la rotaci√≥n y el tambaleo ‚öì
        });

        // ‚öì 2. El punto de anclaje (Est√°tico e invisible arriba en el cielo)
        const ancla = Bodies.circle(400, 50, 10, { isStatic: true, render: { visible: false } });

       // üîó 3. El resorte (La Magia de la Gravedad)
        const resorte = Constraint.create({
            bodyA: ancla,
            bodyB: contenedor,
            pointB: { x: 0, y: -80 }, 
            stiffness: 0.007, // <-- Antes era 0.03. Ahora es mucho m√°s suave (aumentamos 'm') üìâ
            damping: 0.1,     // <-- Frena un poco el rebote para que se vea elegante
            length: 150      
        });
        
        Composite.add(engine.world, [contenedor, ancla, resorte]);
        
        let contadorUnidades = 0;
        let canicasActivas = []; // Llevamos un registro de las canicas f√≠sicas

        function agregarCanica(valor) {
            contadorUnidades += valor;
            
            // L√ìGICA DE DESBORDE (Al llegar a 10)
            if (contadorUnidades >= 10) {
                console.log("¬°L√≠mite alcanzado! Extrayendo unidades...");
                
                // Solo eliminamos las canicas, ¬°no el contenedor!
                canicasActivas.forEach(c => Composite.remove(engine.world, c));
                canicasActivas = []; // Vaciamos el registro
                contadorUnidades = contadorUnidades - 10;
                
                // ¬°Al quitar el peso, ver√°s el contenedor rebotar hacia arriba maravillosamente! üéà
                return;
            }

            // Generar la canica con masa equivalente a su valor
            let radio = valor === 1 ? 15 : 30;
            let color = valor === 1 ? '#00E676' : '#FF4081';
            let masa = valor === 1 ? 2 : 10; // La tombolocha pesa 5 veces m√°s
            
            let nuevaCanica = Bodies.circle(400, 100, radio, { 
                restitution: 0.5, 
                mass: masa,
                render: { fillStyle: color } 
            });
            
            canicasActivas.push(nuevaCanica); // Guardamos referencia
            Composite.add(engine.world, nuevaCanica);
        }

        Render.run(render);
        const runner = Runner.create();
        Runner.run(runner, engine);
    </script>
</body>
</html>
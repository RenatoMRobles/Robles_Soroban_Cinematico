<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Soroban Cinem√°tico - Robles y Robles</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body {
            margin: 0; padding: 0; background-color: #121212;
            color: #E0E0E0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex; flex-direction: column; align-items: center; overflow: hidden;
        }
        h1 { margin-top: 20px; font-weight: 300; letter-spacing: 2px; color: #00E676; }
        #canvas-container {
            width: 800px; height: 600px; border: 1px solid #333;
            box-shadow: 0 0 20px rgba(0, 230, 118, 0.1); border-radius: 10px; margin-top: 20px;
        }
        .controls { margin-top: 20px; }
        button {
            background-color: #1E1E1E; color: #00E676; border: 1px solid #00E676;
            padding: 10px 20px; border-radius: 5px; cursor: pointer; transition: all 0.3s ease;
        }
        button:hover { background-color: #00E676; color: #121212; }
    </style>
</head>
<body>
    <h1>SOROBAN CINEM√ÅTICO</h1>
    <div class="controls">
        <button onclick="agregarCanica(1)">+1 Unidad (Canica)</button>
        <button onclick="agregarCanica(5)">+5 Unidades (Tombolocha)</button>
    </div>
    <div id="canvas-container"></div>
    <script>
        // Inicializaci√≥n y f√≠sicas por el equipo Robles y Robles üè¢‚ú®
        const Engine = Matter.Engine, 
              Render = Matter.Render, 
              Runner = Matter.Runner, 
              Bodies = Matter.Bodies, 
              Body = Matter.Body, 
              Constraint = Matter.Constraint, 
              Composite = Matter.Composite;

        const engine = Engine.create();
        const render = Render.create({
            element: document.getElementById('canvas-container'),
            engine: engine,
            options: { width: 800, height: 600, wireframes: false, background: 'transparent' }
        });

        const opcionesPared = { render: { fillStyle: '#333' } };

        // ==========================================
        // üèõÔ∏è 1. COLUMNA DE UNIDADES (Derecha)
        // ==========================================
        const baseU = Bodies.rectangle(550, 350, 160, 20, opcionesPared);
        const izqU = Bodies.rectangle(480, 260, 20, 200, opcionesPared);
        const derU = Bodies.rectangle(620, 260, 20, 200, opcionesPared);

        const contenedorUnidades = Body.create({
            parts: [baseU, izqU, derU], friction: 0.5, mass: 10, inertia: Infinity 
        });

        const anclaU = Bodies.circle(550, 50, 10, { isStatic: true, render: { visible: false } });
        const resorteUnidades = Constraint.create({
            bodyA: anclaU, bodyB: contenedorUnidades, pointB: { x: 0, y: -80 }, 
            stiffness: 0.007, damping: 0.1, length: 150      
        });

        // ==========================================
        // üèõÔ∏è 2. COLUMNA DE DECENAS (Izquierda)
        // ==========================================
        const baseD = Bodies.rectangle(250, 350, 160, 20, opcionesPared);
        const izqD = Bodies.rectangle(180, 260, 20, 200, opcionesPared);
        const derD = Bodies.rectangle(320, 260, 20, 200, opcionesPared);

        const contenedorDecenas = Body.create({
            parts: [baseD, izqD, derD], friction: 0.5, mass: 10, inertia: Infinity 
        });

        const anclaD = Bodies.circle(250, 50, 10, { isStatic: true, render: { visible: false } });
        const resorteDecenas = Constraint.create({
            bodyA: anclaD, bodyB: contenedorDecenas, pointB: { x: 0, y: -80 }, 
            stiffness: 0.007, damping: 0.1, length: 150      
        });

        // Agregamos ambas infraestructuras al mundo
        Composite.add(engine.world, [
            contenedorUnidades, anclaU, resorteUnidades,
            contenedorDecenas, anclaD, resorteDecenas
        ]);
        
        // Variables de estado
        let contadorUnidades = 0;
        let contadorDecenas = 0;
        let canicasUnidades = []; 
        let canicasDecenas = []; 

        // Funci√≥n modular para crear canicas visuales
        function crearCanicaFisica(columna, valor) {
            let x = columna === 'unidades' ? 550 : 250;
            // 1 = verde (15px), 5 = rosa (30px), 10 = azul corporativo (35px)
            let radio = valor === 1 ? 15 : (valor === 5 ? 30 : 35); 
            let color = valor === 1 ? '#00E676' : (valor === 5 ? '#FF4081' : '#2979FF'); 
            let masa = valor === 1 ? 2 : (valor === 5 ? 10 : 20); 

            let nuevaCanica = Bodies.circle(x, 80, radio, { 
                restitution: 0.5, mass: masa, render: { fillStyle: color } 
            });

            if(columna === 'unidades') canicasUnidades.push(nuevaCanica);
            else canicasDecenas.push(nuevaCanica);

            Composite.add(engine.world, nuevaCanica);
        }

        function agregarCanica(valor) {
            contadorUnidades += valor;
            
            // 1. Instanciar la canica visualmente
            crearCanicaFisica('unidades', valor);

            // 2. Verificar si rompimos la barrera del 10
            if (contadorUnidades >= 10) {
                // El setTimeout crea un suspenso visual de medio segundo antes de agrupar
                setTimeout(() => {
                    console.log("¬°L√≠mite alcanzado! Transfiriendo masa a las Decenas...");
                    
                    let excedente = contadorUnidades - 10;
                    
                    // Pulverizar las unidades f√≠sicas actuales (El rebote ser√° glorioso)
                    canicasUnidades.forEach(c => Composite.remove(engine.world, c));
                    canicasUnidades = [];
                    contadorUnidades = excedente;
                    
                    // Instanciar 1 canica en la columna de DECENAS
                    contadorDecenas += 10; 
                    crearCanicaFisica('decenas', 10);

                    // Recrear las canicas sobrantes en unidades (Si metiste un 5 teniendo un 9, te sobran 4)
                    for(let i = 0; i < excedente; i++) {
                        crearCanicaFisica('unidades', 1);
                    }
                }, 600); // 600 milisegundos de gracia üïí
            }
        }

        Render.run(render);
        const runner = Runner.create();
        Runner.run(runner, engine);
    </script>
</body>
</html>